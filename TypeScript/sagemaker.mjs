//Import AWS
import {
  InvokeEndpointCommand,
  SageMakerRuntimeClient,
} from "@aws-sdk/client-sagemaker-runtime";

const region = "us-east-1";

//Create SageMakerRuntimeClient
const client = new SageMakerRuntimeClient({ region });

/* Data we are going to send to endpoint
    REPLACE WITH YOUR OWN DATA!
    Should be last 100 points in your time series (depending on your choice of hyperparameters).
    Make sure that start is correct.
*/
const endpointData = {
  instances: [
    {
      start: "2024-03-20 03:00:00", //"start":"2024-03-02 11:00:00","target"
      target: [
        584.0811483073427, 538.3878710192757, 562.7484551896878,
        548.3694298598332, 588.756169357936, 556.4403949231349,
        581.0836611797495, 583.9481794597474, 590.2435546608792,
        647.9374845901385, 610.3142318141946, 645.5856589015983,
        655.9263699439213, 682.5055337598751, 661.0060310163719,
        674.0106015906263, 676.739110987733, 659.0836069588968,
        626.6938645238613, 608.9653545085533, 642.5287882494621,
        595.0471511646929, 581.6789017390462, 578.4498169406241,
        600.3813060809226, 557.8345519084678, 560.0057016201315,
        562.1347368857519, 609.3325380782281, 589.3493474065149,
        626.3260237448657, 605.2140330282309, 603.6573031185048,
        661.5589965441777, 672.8692786285233, 668.4444057506221,
        648.7388986316573, 658.1618068824915, 654.0987430416993,
        700.2753696756091, 699.7025796986804, 648.738481936615,
        675.681313298781, 666.2512564861107, 664.9567909684177,
        610.0923837948443, 601.0949469009897, 601.2725486737846,
        594.2229257642572, 588.8016638569258, 616.1024115082452,
        581.5411713862405, 587.9429118371684, 608.8953057285969,
        653.4031225722969, 625.009727351618, 622.9887592312874,
        699.4665888141841, 695.3591787088827, 654.2733853584365,
        705.6029600333453, 701.542619584541, 701.7972994643706,
        683.2688432860066, 710.035206550533, 716.703933008104,
        714.1116132539025, 670.3508858735078, 682.8208521243355,
        685.8005348365082, 655.4304275156427, 613.716772020171,
        658.5912122791631, 634.6399210742111, 635.438158310039,
        618.9045807521095, 665.8610814237669, 666.5123523429311,
        647.6738930257014, 669.6855779916143, 689.7158489109946,
        661.528196261668, 688.1206005400859, 708.8762099086481,
        684.5570766565553, 705.2662517605728, 717.2672742725537,
        755.4190837592467, 735.0720492497309, 692.2105065764315,
        702.7872073900755, 672.8540481892577, 690.697137096882,
        691.5608997956241, 683.6019023200055, 656.6193572284567,
        684.6915963458998, 681.7843780857978, 658.8922033331243,
        678.2546259491731,
      ],
    },
  ],
  configuration: {
    num_samples: 5,
    output_types: ["mean", "quantiles", "samples"],
    quantiles: ["0.1", "0.9"],
  },
};

//Calls endpoint and logs results
async function invokeEndpoint() {
  //Create and send command with data
  const command = new InvokeEndpointCommand({
    EndpointName: "testEndpoint2",
    Body: JSON.stringify(endpointData),
    ContentType: "application/json",
    Accept: "application/json",
  });
  const response = await client.send(command);

  //Must install @types/node for this to work
  let predictions = JSON.parse(Buffer.from(response.Body).toString("utf8"));
  // console.log(predictions.predictions[0].quantiles);
  console.log(predictions.predictions[0].mean);
}

invokeEndpoint();
